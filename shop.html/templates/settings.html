<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <style>
        :root {
            --c-bg: #e9ecef; --c-text: #212529; --c-text-secondary: #6c757d; --c-header-bg: #ffffff; --c-card-bg: #ffffff; --c-accent: #0d6efd; --c-accent-darker: #0b5ed7; --c-border: #dee2e6; --c-shadow: rgba(0, 0, 0, 0.1);
        }
        body.dark-theme {
            --c-bg: #121212; --c-text: #e9ecef; --c-text-secondary: #adb5bd; --c-header-bg: #1c1c1c; --c-card-bg: #1c1c1c; --c-accent: #3b82f6; --c-accent-darker: #2563eb; --c-border: #343a40; --c-shadow: rgba(0, 0, 0, 0.25);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--c-bg);
            color: var(--c-text);
            line-height: 1.6;
        }
        body {
            padding-left: 60px; /* Space for desktop side toolbar */
            transition: padding-left 0.3s ease, padding-bottom 0.3s ease;
        }
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 20px;
        }
        a { color: var(--c-accent); text-decoration: none; }

        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--c-border);
        }
        .page-header h1 { font-size: 2.2rem; margin: 0; }
        .back-link {
            display: inline-flex; align-items: center; gap: 0.5rem; font-weight: 500; color: var(--c-text);
            padding: 0.5rem 1rem; border-radius: 8px; transition: background-color 0.2s ease;
        }
        .back-link:hover { background-color: var(--c-card-bg); }
        .back-link svg { stroke: currentColor; width: 20px; height: 20px; }

        .settings-card {
            background-color: var(--c-card-bg);
            border-radius: 12px;
            padding: 1rem 2rem;
            box-shadow: 0 4px 15px var(--c-shadow);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--c-border);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .info-card {
            background-color: var(--c-card-bg);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 15px var(--c-shadow);
            margin-top: 2rem;
            text-align: center;
        }
        .info-card h2 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        .info-card p {
            color: var(--c-text-secondary);
            max-width: 60ch;
            margin-left: auto;
            margin-right: auto;
        }
        .action-button {
            display: inline-block;
            background-color: var(--c-accent);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: background-color 0.2s ease;
            margin-top: 1rem;
        }
        .action-button:hover {
            background-color: var(--c-accent-darker);
            color: white;
        }
        .owner-card {
            display: flex; /* Changed to flex row */
            flex-direction: row;
            align-items: flex-start; /* Align items to the top */
            gap: 2rem;
            text-align: left; /* Override center alignment from .info-card */
        }
        .owner-details {
            flex: 1; /* Allow text block to grow */
        }
        .owner-photo {
            width: 80px; /* Made smaller */
            height: 80px; /* Made smaller */
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 0; /* Reset margin */
            border: 3px solid var(--c-accent);
            flex-shrink: 0; /* Prevent image from shrinking */
        }
        .owner-card h3 { margin: 0; }
        .owner-title { color: var(--c-text-secondary); font-weight: 500; margin-top: 0.25rem; }
        .owner-card p {
            margin-left: 0; /* Override centered paragraph from .info-card */
            margin-right: 0;
        }
        .setting-item .label {
            font-weight: 500;
        }

        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--c-accent);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        /* New styles for the guide section */
        .guide-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, margin-top 0.5s ease-out;
            width: 100%;
        }
        .guide-content.visible {
            max-height: 2000px; /* A large value to accommodate content */
            margin-top: 1.5rem;
            transition: max-height 1s ease-in, margin-top 0.5s ease-in;
        }
        .guide-content h4 {
            margin-top: 0;
            color: var(--c-accent);
        }
        .guide-content p, .guide-content ul {
            color: var(--c-text-secondary);
            font-size: 0.95rem;
        }
        .guide-content ul {
            padding-left: 1.5rem;
        }
        /* Side Toolbar Styles (from shop.html) */
        .toolbar-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            box-shadow: 0 0 0 2px var(--c-header-bg);
        }
        .side-toolbar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 60px;
            background-color: var(--c-header-bg);
            border-right: 1px solid var(--c-border);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem 0;
            box-shadow: 1px 0 5px var(--c-shadow);
            transition: all 0.3s ease;
        }
        .side-toolbar .toolbar-logo img {
            height: 35px;
            width: 35px;
            border-radius: 50%;
            object-fit: cover;
        }
        .toolbar-item {
            background: none;
            border: none;
            color: var(--c-text-secondary);
            cursor: pointer;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: color 0.2s ease;
            position: relative;
            margin-top: 17px;
        }
        .toolbar-item:hover { color: var(--c-accent); }
        .toolbar-item svg { width: 24px; height: 24px; stroke: currentColor; }
        .account-button { display: none; }
        .toolbar-item.settings {
            margin-top: auto;
            position: absolute;
            bottom: 5%;
        }
        @media (max-width: 768px) {
            body { padding-left: 0; padding-bottom: 45px; }
            .side-toolbar {
                top: auto;
                bottom: 0;
                width: 100%;
                height: 45px;
                flex-direction: row;
                border-radius: 9px 9px 0px 0px;
                justify-content: space-around;
                align-items: center;
                border-right: none;
                border-top: 1px solid #000000;
                padding: 0;
                background-color: var(--c-header-bg-translucent);
                -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px);
            }
            .side-toolbar .toolbar-logo { display: none; }
            .toolbar-item { flex-grow: 1; color: var(--c-text); margin-top: 0; }
            .side-toolbar .settings { display: none; position: static; }
            .side-toolbar .account-button { display: flex; }
            .toolbar-item svg { width: 22px; height: 22px; }
            .toolbar-badge {
                top: 10px; right: 28px; background-color: #e5192d; width: 15px;
                border: none; height: 15px; font-size: 0.7rem;
                box-shadow: 0 0 0 2px var(--c-header-bg-translucent);
            }
        }

    </style>
</head>
<body>
    <nav class="side-toolbar" aria-label="Utility navigation">
        <a href="{% if user %}/account{% else %}#{% endif %}" class="toolbar-logo" aria-label="Account">
            {% if user and user.name %}
            <img src="{{ user.photo or 'https://placehold.co/40x40/222831/EEEEEE?text=' + user.name[0]|upper }}" alt="User initial logo">
            {% else %}
            <img src="https://placehold.co/40x40/222831/EEEEEE?text=M&font=sans" alt="MyStore mini logo">
            {% endif %}
        </a>
        <a href="/" class="toolbar-item" aria-label="Home">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        </a>
        {% if user and user.role == 'admin' %}
        <a href="/admin" class="toolbar-item" aria-label="Product Manager">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </a>
        {% endif %}
        <a href="/saved" class="toolbar-item" aria-label="Saved Items">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
        </a>
        <a href="/chat" class="toolbar-item" aria-label="Chat with support">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
            {% if total_unread_count and total_unread_count > 0 %}
                <span class="toolbar-badge">{{ total_unread_count }}</span>
            {% endif %}
        </a>
        <a href="/account" class="toolbar-item account-button" aria-label="My Account">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        </a>
        <a href="/settings" class="toolbar-item settings" aria-label="Settings">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </a>
    </nav>
    <div class="container">
        <header class="page-header">
            <h1>Settings</h1>
            <a href="/" class="back-link" aria-label="Back to Shop">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
            </a>
        </header>

        <main>
            <div class="settings-card">
                <div class="setting-item">
                    <span class="label">Dark Mode</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="theme-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <!-- More settings can be added here in the future -->
            </div>

            <!-- New About & Guide Section -->
            <div class="settings-card" style="margin-top: 2rem; padding-bottom: 2rem;">
                <div class="setting-item" style="flex-direction: column; align-items: flex-start; gap: 1rem; padding-bottom: 2rem;">
                    <h3 style="margin: 0; font-size: 1.5rem;">About Our Service</h3>
                    <p style="color: var(--c-text-secondary); margin: 0;">
                        MyStore is a platform designed to bridge the gap between local merchants and customers. Our mission is to empower small businesses by providing a simple, elegant, and effective way to showcase their products to a wider audience. We believe in the power of local commerce and strive to create a community where shopping is personal, convenient, and supports local entrepreneurs.
                    </p>
                </div>
                <div id="guide-section" class="setting-item" style="flex-direction: column; align-items: flex-start; gap: 1rem; border-bottom: none;">
                    <h3 style="margin: 0; font-size: 1.5rem;">How It Works</h3>
                    <p style="color: var(--c-text-secondary); margin: 0;">
                        Whether you're here to shop or to sell, our platform is designed to be intuitive. Hereâ€™s a quick guide to get you started.
                    </p>
                    <button id="toggle-guide-btn" class="action-button" style="margin-top: 1rem; background-color: var(--c-neutral-bg); color: var(--c-text); border: 1px solid var(--c-border);">Read Full Guide</button>
                    <div id="guide-content" class="guide-content">
                        <h4 style="margin-top: 1rem;">For Shoppers: Discover & Connect</h4>
                        <p><strong>1. Explore Products:</strong> Browse our homepage to see featured items and the latest products organized by category. Use the horizontal scroll on each row to see more.</p>
                        <p><strong>2. Search with Ease:</strong> Use the search bar at the top to find specific products, brands, or categories. Our search is fast and designed to help you find exactly what you're looking for.</p>
                        <p><strong>3. View Details:</strong> Click on any product to see more details, including multiple high-quality images, a full description, price, and location.</p>
                        <p><strong>4. Save for Later:</strong> Not ready to buy? Click the bookmark icon on a product page to add it to your "Saved Items" list. You can view your saved items anytime from the side toolbar.</p>
                        <p><strong>5. Contact Merchants:</strong> When you're ready to inquire, you have several options on the product page:
                            <ul>
                                <li><strong>Chat:</strong> Use our built-in chat system for a secure and direct conversation with the seller.</li>
                                <li><strong>WhatsApp & Call:</strong> If the merchant has provided their number, you can contact them instantly via WhatsApp or a direct phone call.</li>
                            </ul>
                        </p>
                        <h4 style="margin-top: 2rem;">For Merchants: Showcase & Sell</h4>
                        <p><strong>1. Create Your Store:</strong> Signing up is easy! Click the account icon and create your merchant account. Once registered, you automatically get access to your own product management dashboard.</p>
                        <p><strong>2. Add Your Products:</strong> Navigate to the "Product Manager" from the side toolbar. Here you can add new products with all the necessary details, including high-quality images, detailed descriptions, and accurate pricing.</p>
                        <p><strong>3. Manage Inquiries:</strong> When a customer sends you a message, you'll receive a notification. Access all your conversations through the "Chat" icon on the side toolbar, where you can reply to customers, answer questions, and arrange sales.</p>
                        <p><strong>4. Track Performance:</strong> On each product page you own, you can see how many times your item has been viewed and how many inquiries it has received, helping you understand what's popular in your store.</p>
                    </div>
                </div>
            </div>

            <div class="info-card">
                <h2>Contact Support</h2>
                <p>Our support team is here for you. If you have any questions about products, orders, or just want to say hello, don't hesitate to reach out.</p>
                <a href="/chat?support=true" class="action-button">Get Help</a>
            </div>

            <div class="info-card">
                <h2>Our Commitment to You</h2>
                <p>At MyStore, we're dedicated to bringing you a curated selection of high-quality products with a seamless shopping experience. We believe in quality, style, and exceptional customer service. Explore our collections and discover your next favorite item.</p>
            </div>

            <div class="info-card owner-card">
                <div class="owner-details">
                    <h3>Mr. Asanji Bruno</h3>
                    <p class="owner-title">Founder & CEO</p>
                    <p>
                        "Thank you for visiting our store. My passion is to connect people with products they love. We are constantly working to improve your experience and are grateful for your support."
                    </p>
                </div>
                <img src="https://placehold.co/100x100/3b82f6/ffffff?text=AB&font=sans" alt="Mr. Asanji Bruno" class="owner-photo">
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.getElementById('theme-toggle');

            const applyTheme = (theme) => {
                document.body.classList.toggle('dark-theme', theme === 'dark');
                if (themeToggle) {
                    themeToggle.checked = theme === 'dark';
                }
            };

            const toggleTheme = () => {
                const currentTheme = localStorage.getItem('theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            };

            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);

            if (themeToggle) {
                themeToggle.addEventListener('change', toggleTheme);
            }

            // Listen for theme changes from other tabs to keep the toggle in sync
            window.addEventListener('storage', (e) => {
                if (e.key === 'theme') applyTheme(e.newValue);
            });

            // --- GUIDE TOGGLE LOGIC ---
            const toggleBtn = document.getElementById('toggle-guide-btn');
            const guideContent = document.getElementById('guide-content');

            if (toggleBtn && guideContent) {
                toggleBtn.addEventListener('click', () => {
                    guideContent.classList.toggle('visible');
                    if (guideContent.classList.contains('visible')) {
                        toggleBtn.textContent = 'Hide Guide';
                    } else {
                        toggleBtn.textContent = 'Read Full Guide';
                    }
                });
            }

            // --- Handle URL Hash for Guide ---
            // If the user comes from the "About" link, automatically open the guide.
            if (window.location.hash === '#guide-section') {
                if (guideContent && toggleBtn && !guideContent.classList.contains('visible')) {
                    guideContent.classList.add('visible');
                    toggleBtn.textContent = 'Hide Guide';
                }
            }
        });
    </script>
</body>
</html>